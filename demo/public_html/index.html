<!DOCTYPE html>
<html lang="en">
<head>
    <title>Threaded Objects</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
<div id="viewer" style="position:absolute; top:0px; left:0px;"></div>

<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
<script type="importmap">
{
    "imports": {
        "three": "https://unpkg.com/three@0.141.0/build/three.module.js"
    }
}
</script>
<script type="module">

import * as THREE from 'three';

import { OrbitControls } from 'https://unpkg.com/three@0.141.0/examples/jsm/controls/OrbitControls.js';

import { PLYLoader } from 'https://unpkg.com/three@0.141.0/examples/jsm/loaders/PLYLoader.js';

let container;

let camera, cameraTarget, scene, renderer, controls, scale;

init();
animate();


function init() {

  container = document.getElementById( 'viewer' );

  camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 0.5, 99999999 );
  camera.position.set( 2, 1, 2 );

  cameraTarget = new THREE.Vector3( 0, 0, 0 );

  scene = new THREE.Scene();
  scene.background = new THREE.Color( 0x444444 );

/*
  // Ground

  const plane = new THREE.Mesh(
      new THREE.PlaneGeometry( 4, 4 ),
      new THREE.MeshPhongMaterial( { color: 0x999999, specular: 0x101010 } )
  );
  plane.rotation.x = - Math.PI / 2;
  plane.position.y = - 0.5;
  scene.add( plane );

  plane.receiveShadow = true;
*/

  // PLY file

  const loader = new PLYLoader();
  const geometry = loader.parse(PLY.fromMesh(Screw(), PLY.randomVertexColorMapper))

    geometry.computeVertexNormals();

    geometry.computeBoundingBox();
    var origin = geometry.boundingBox.getCenter(new THREE.Vector3());
    console.log(origin);
    geometry.center();

    geometry.computeBoundingBox();
    var offset = geometry.boundingBox.getCenter(new THREE.Vector3());
    offset.sub(origin);
    console.log(offset);

    const material = new THREE.MeshBasicMaterial( { vertexColors: true } );
    const mesh = new THREE.Mesh( geometry, material );

    mesh.scale.multiplyScalar( 0.25 );
    mesh.castShadow = false;
    mesh.receiveShadow = false;

    scene.add( mesh );



  // no Lights!
  // renderer

  renderer = new THREE.WebGLRenderer( { antialias: true } );
  renderer.setPixelRatio( window.devicePixelRatio );
  renderer.setSize( window.innerWidth, window.innerHeight );
  renderer.outputEncoding = THREE.sRGBEncoding;

  renderer.shadowMap.enabled = false;

  container.appendChild( renderer.domElement );


  controls = new OrbitControls( camera, renderer.domElement );
  controls.target.set( 0, 0, 0 );
  controls.update();
  controls.enablePan = false;
  controls.enableDamping = true;

  // resize

  window.addEventListener( 'resize', onWindowResize );

}

function addShadowedLight( x, y, z, color, intensity ) {

	const directionalLight = new THREE.DirectionalLight( color, intensity );
	directionalLight.position.set( x, y, z );
	scene.add( directionalLight );

	directionalLight.castShadow = true;

	const d = 1;
	directionalLight.shadow.camera.left = - d;
	directionalLight.shadow.camera.right = d;
	directionalLight.shadow.camera.top = d;
	directionalLight.shadow.camera.bottom = - d;

	directionalLight.shadow.camera.near = 1;
	directionalLight.shadow.camera.far = 4;

	directionalLight.shadow.mapSize.width = 1024;
	directionalLight.shadow.mapSize.height = 1024;

	directionalLight.shadow.bias = - 0.001;

}

function onWindowResize() {

	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();

	renderer.setSize( window.innerWidth, window.innerHeight );

}

function animate() {

	requestAnimationFrame( animate );

	render();

}

function render() {

	//const timer = Date.now() * 0.0005;
/*
	camera.position.x = Math.sin( timer ) * 2.5;
	camera.position.z = Math.cos( timer ) * 2.5;
*/
	controls.update();

	//camera.lookAt( cameraTarget );

	renderer.render( scene, camera );

}
render();
</script>
<script type="application/javascript" src="./js/main.js"></script>
</body>
</html>
